### chapter11 动态分配内存

#### malloc和free

malloc和free是两个函数分别用于执行动态内存分配和释放，这些函数维护一个内存池，当一个程序另外需要一些内存时，就调用malloc函数，从内存池中提取一块合适的内存，并向该程序返回一个指向这块内存的指针。

这两个函数都存在于头文件stdlib.h中，函数原型分别为：

void *malloc(size_t size);

void *free(void *pointer);

#### calloc和realloc

calloc和realloc函数是两个内存分配函数，函数原型分别为：

void *calloc(size_t num_elements, size_t element_size);

void *realloc(void *ptr, size_t new_size);

----------

在使用free()函数时，我们常常需要注意的是传递给free的指针一定是一个从malloc或者calloc或者realloc函数返回的指针。传给free函数一个指针让他释放一个并非动态分配的内存可能导致程序的终止。

#### 课后习题

1. 在你的系统中能够声明的最大的静态数组的长度可以达到多少？使用动态分配内存最大能够获取的内存块的大小有多大？

   *不同的系统下有很多不同的影响因素，包括：存储器类型的使用，数据或者堆栈段的大小，变量空间的大小等*

2. 当你一次请求分配500个字节的内存时，你实际获得的动态分配的内存数量总共有多大？当你一次请求分配5000个字节时又如何？存在区别吗？

   *要求分配更小的内存块可能会允许分配更多的内存，最后内存分配剩余的总量会更小。*

3. 在一个从文件读取字符串的程序中，有没有什么值可以合乎逻辑地作为输入缓冲区的长度？

   *如果输入包含在一个文件中，它肯定是由其他程序放在那里的。如果是这种情况，最长行的长度是由编辑器程序支持的，它会做出一个合乎逻辑的选择，确定你的输入缓冲区的大小。*

4. 有些C编译器提供了一个称为`alloca`的函数，它与`malloc`函数的不同之处在于它在堆栈上分配内存。这种类型的分配有什么优点和缺点？

   *优点：分配内存的函数在返回时会自动释放内存（这是由堆栈的工作方式决定的），这样可以保证不会发生内存的泄漏。*

   *缺点：分配的内存不能够用于存储函数或者程序回调时需要的数据。*

5. 假定你需要编写一个程序，并希望最大程度的减少堆栈的使用量，动态分配内存能不能对你带来一些帮助？使用标量数据又该如何？

   *动态内存分配可以帮助减少堆栈的使用，使用动态内存分配的数组的内存会从内存堆中获取而不是堆栈；标量的分配仅仅在分配的大小远远大于一个指针的时候才会有所帮助，对于一个整型变量使用动态分配没什么意义。*

6. 删除free()函数的后果往往都是产生内存泄露，后续程序内存不够用。